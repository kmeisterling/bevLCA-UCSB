ggsave("./figs/figsBW/FIG5bw_imp_ibs_scen0.pdf", width=13, height=8, units="in")
imp_i_allscen %>%
select(scen_name, imp_name, item, value) %>%
pivot_wider(names_from = scen_name, values_from = value) %>%
arrange(imp_name) %>%
write_csv("./data/data_tbls/TSI11_imp_i_allscen_wide.csv")
imp_is_allscen <- imp_scl %>%
group_by(scen, item, SSB_status, imp_type) %>%
summarize(value = sum(value)) %>%
ungroup() %>%
left_join(scenNames) %>%
relocate(scen_name) %>%
select(-scen) %>%
left_join(impNames)
View(imp_is_allscen)
imp_is_allscen %>% ggplot() +
theme_bw() +
geom_col(aes(y = value, x = SSB_status, fill = item),
width = 0.8) +
facet_grid(vars(imp_regex_abs),
vars(scen_name),
switch = "y",
scales = "free",
labeller = labeller(
imp_regex_abs = label_parsed
)
) +
geom_hline(yintercept = 0) +
geom_vline(xintercept = 0.5) +
xlab("") +
ylab("") +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
panel.border = element_blank(),
strip.placement = "outside",
text = element_text(size=14),
legend.title=element_blank()
) +
scale_fill_manual(values = col_vir1)
ggsave("./figs/imp_is_allscen.pdf", width=13, height=8, units="in")
summ_imp_wide <- imp_scl %>%
pivot_wider(names_from = imp_type, values_from = value) %>%
replace(is.na(.), 0)
#View(summ_imp_wide)
write_csv(summ_imp_wide, "./data/data_tbls/imp_bsc_allscen_wide.csv")
View(imp_i_allscen)
#View(imp_i_allscen)
imp_i_allscen %>%
group_by(scen_name, imp_name) %>%
summarize(value = sum(value)) %>%
ungroup() %>%
pivot_wider(names_from = imp_name, values_from = value) %>%
write_csv("./data/data_tbls/imp_allscen.csv")
imp_s0 %>%
group_by(imp_name, item) %>%
summarize(value = sum(value)) %>%
pivot_wider(names_from = item, values_from = value) %>%
replace_na(list(beverage = 0)) %>%
write_csv("./data/data_tbls/imp_scen0_summ.csv")
c1 <- read_csv("./data/cont_imp_l.csv") %>%
left_join(contNames) %>%
select(!cont_name_2) %>%
select(!cont_type) %>%
pivot_longer(!cont_name, names_to = "imp_type", values_to = "val") %>%
left_join(impNames)
FIG3 <- c1 %>%
ggplot() + theme_bw() +
geom_col(aes(y = val, x = cont_name), width = 0.8, fill = col_cont) +
facet_grid(rows = vars(imp_regex_perL),
switch = "y",
scales = "free",
labeller = labeller(
imp_regex_perL = label_parsed
)) +
geom_hline(yintercept = 0) +
geom_vline(xintercept = 0.4) +
labs(
x ="Container Category",
y = "Impacts per liter of container (no beverage)") +
theme(
text = element_text(size=14),
axis.text.x = element_text(angle = 45, hjust = 1),
#    legend.text = element_text(size = 16),
#    axis.text.y = element_text(size = 16),
panel.border = element_blank(),
strip.placement = "outside")
FIG3
ggsave("./figs/FIG3_cont_imp_liter.pdf", width=4, height=8, units="in")
c1 %>%
ggplot() + theme_bw() +
geom_col(aes(y = val, x = cont_name), width = 0.8) +
facet_grid(rows = vars(imp_regex_perL),
switch = "y",
scales = "free",
labeller = labeller(
imp_regex_perL = label_parsed
)) +
geom_hline(yintercept = 0) +
geom_vline(xintercept = 0.4) +
labs(
x ="Container Category",
y = "Impacts per liter of container (no beverage)") +
theme(
text = element_text(size=14),
axis.text.x = element_text(angle = 45, hjust = 1),
#    legend.text = element_text(size = 16),
#    axis.text.y = element_text(size = 16),
panel.border = element_blank(),
strip.placement = "outside")
ggsave("./figs/figsBW/FIG3bw_cont_imp_liter.pdf", width=4, height=8, units="in")
temp1 <- read_csv("./data/bev_imp_l.csv")
View(temp1)
#View(temp1)
b1 <- temp1 %>%
filter(bev_type != "water_tap") %>%
left_join(bevNames) %>%
select(-c("bev_type", "bev_regex")) %>%
pivot_longer(!c("bev_name", "SSB_status"), names_to = "imp_type", values_to = "val") %>%
drop_na() %>%
left_join(impNames)
View(b1)
remove(temp1)
FIG2 <- b1 %>% ggplot() +
theme_bw() +
geom_col(aes(y = val, x = bev_name), width = 0.8, fill = col_bev) +
facet_grid(rows = vars(imp_regex_perL),
cols = vars(SSB_status),
switch = "y",
scales = "free",
labeller = labeller(
imp_regex_perL = label_parsed
)) +
geom_hline(yintercept = 0) +
geom_vline(xintercept = 0.41) +
labs(
x ="Beverage Category",
y = "Impacts per liter of beverage (no container)") +
theme(
text = element_text(size=14),
axis.text.x = element_text(angle = 45, hjust = 1),
strip.placement = "outside",
#    legend.text = element_text(size = 16),
#    axis.text.y = element_text(size = 16),
panel.border = element_blank() ) +
scale_y_continuous(labels=function(x) format(x, big.mark = ",", scientific=FALSE))
FIG2
ggsave("./figs/FIG2_bev_imp_liter.pdf", width=8, height=8, units="in")
## Make BW version
b1 %>% ggplot() +
theme_bw() +
geom_col(aes(y = val, x = bev_name), width = 0.8) +
facet_grid(rows = vars(imp_regex_perL),
cols = vars(SSB_status),
switch = "y",
scales = "free",
labeller = labeller(
imp_regex_perL = label_parsed
)) +
geom_hline(yintercept = 0) +
geom_vline(xintercept = 0.41) +
labs(
x ="Beverage Category",
y = "Impacts per liter of beverage (no container)") +
theme(
text = element_text(size=14),
axis.text.x = element_text(angle = 45, hjust = 1),
strip.placement = "outside",
#    legend.text = element_text(size = 16),
#    axis.text.y = element_text(size = 16),
panel.border = element_blank() ) +
scale_y_continuous(labels=function(x) format(x, big.mark = ",", scientific=FALSE))
ggsave("./figs/figsBW/FIG2bw_bev_imp_liter.pdf", width=8, height=8, units="in")
library(tidyverse)
#library(ggtext)
library(viridis)
# Colors --
col_vir1 <- c("beverage" = "#21908C", "container" = "#440154")
col_bev <- c("#21908C")
col_cont <- c("#440154")
bevNames_temp <- read_csv("./data/bevtype_list_name.csv")
#View(bevNames_temp)
bevNames <- bevNames_temp %>%
mutate(bev_regex = bev_name) %>%
#  mutate(bev_regex = str_replace(bev_regex, "+ ", "+~")) %>%
mutate(bev_regex = str_replace(bev_regex, " ", "~")) %>%
mutate(bev_regex = str_replace(bev_regex, ",", "*','*"))
#View(bevNames)
remove(bevNames_temp)
contNames <- read_csv("./data/conttype_list_name.csv")
impNames <- read_csv("./data/imptype_list_name.csv")
scenNames <- read_csv("./data/scen_list_name.csv")
## Make a table to replace "distrib" values
distrib_corr <- tribble(~distrib, ~distrib_name,
"Dining + Vending", "Dining + Vending",
"dining",  "Dining",
"vending", "Vending"
)
temp_flow <- read_csv("./data/vol_dbsc_din+vend_scen0.csv") %>%
left_join(distrib_corr) %>%
select(-distrib) %>%
mutate(distrib = distrib_name) %>%
select(-distrib_name) %>%
relocate(distrib)
#View(temp_flow)
remove(distrib_corr)
flow_s0_fig <- temp_flow %>%
mutate(distrib = factor(distrib, levels=c("Dining + Vending", "Dining", "Vending"))) %>%
mutate(SSB_status = as_factor(SSB_status)) %>%
mutate(SSB_status = fct_rev(SSB_status))
#View(flow_s0_fig)
remove(temp_flow)
FIG1 <- flow_s0_fig %>%
left_join(contNames) %>%
left_join(bevNames) %>%
ggplot() + theme_bw() +
geom_col(aes(y = vol_kL, x = bev_name, fill = cont_name), width = 0.8) +
facet_grid(rows = vars(distrib),
cols = vars(SSB_status),
switch = "y") +
geom_hline(yintercept = 0) +
geom_vline(xintercept = 0.5) +
labs(
x ="Beverage Category",
y = "Thousand Liters / year",
fill = "container\ntype") +
theme(
text = element_text(size=14),
axis.text.x = element_text(angle = 45, hjust = 1),
#    legend.text = element_text(size = 16),
#    axis.text.y = element_text(size = 16),
panel.border = element_blank(),
strip.placement = "outside") +
#  scale_fill_viridis(discrete=TRUE)
scale_fill_brewer(palette = "Dark2")
FIG1
remove(FIG1)
#Scale the Flow data for allscen (not including distrib)
flow_scl <- read_csv("./data/flow_bsc_allscen.csv") %>%
mutate(vol_kL = vol/1000) %>%   #Resacle values
select(!vol) %>%
mutate(SSB_status = as_factor(SSB_status)) %>%
mutate(SSB_status = fct_rev(SSB_status))
# !!! Test that all scenarios have same volume
flow_scl %>%
group_by(scen) %>%
summarize(TOTAL = sum(vol_kL))
flow_bsc_scen0 <- flow_scl %>%
filter(scen == "scen0") %>%
group_by(bev_type, SSB_status, cont_type) %>%
summarize(vol_kL = sum(vol_kL)) %>%
ungroup() %>%
filter(bev_type != "water_ucsb") %>%
left_join(bevNames) %>%
left_join(contNames) %>%
mutate(bev_name = fct_reorder(bev_name, vol_kL, .fun = (sum), .desc =  TRUE))
## By bev type, cont type, and SSB status
flow_bsc_scen0 %>%
ggplot() + theme_bw() +
geom_col(aes(y = vol_kL, x = bev_name, fill = cont_name), width = 0.8) +
facet_wrap(vars(SSB_status)) +
#             cols = vars(distrib),
#             switch = "y")
geom_hline(yintercept = 0) +
geom_vline(xintercept = 0.5) +
labs(
x ="Beverage Category",
y = "thousand Liters / yr",
fill = "Container\ntype") +
theme(
text = element_text(size=14),
axis.text.x = element_text(angle = 45, hjust = 1),
#    legend.text = element_text(size = 16),
#    axis.text.y = element_text(size = 16),
panel.border = element_blank(),
strip.placement = "outside") +
scale_fill_brewer(palette = "Dark2")
remove(flow_bsc_scen0)
flow_bs_s0 <- flow_scl %>%
filter(scen == "scen0") %>%
group_by(bev_type, SSB_status) %>%
summarize(vol_kL = sum(vol_kL)) %>%
ungroup() %>%
filter(bev_type != "water_ucsb") %>%
left_join(bevNames) %>%
mutate(bev_name = fct_reorder(bev_name, vol_kL, .fun = (sum), .desc =  TRUE))
flow_bs_s0 %>%
ggplot() + theme_bw() +
geom_col(aes(y = vol_kL, x = bev_name, fill = SSB_status), width = 0.8) +
geom_hline(yintercept = 0) +
geom_vline(xintercept = 0.5) +
labs(
x ="Beverage Category",
y = "thousand liters / yr",
title = "Beverages purchased at UCSB") +
theme(
text = element_text(size=14),
axis.text.x = element_text(angle = 45, hjust = 1),
panel.border = element_blank(),
strip.placement = "outside")
remove(flow_bs_s0)
flow_bc_allscen <- flow_scl %>%
group_by(scen, bev_type, cont_type) %>%
summarize(vol_kL = sum(vol_kL)) %>%
ungroup() %>%
left_join(contNames) %>%
left_join(bevNames) %>%
left_join(scenNames)
FIGSI1 <- flow_bc_allscen %>%
ggplot() +
theme_bw() +
geom_col(aes(y = vol_kL, x = bev_name, fill = cont_name),
width = 0.8) +
geom_hline(yintercept = 0) +
geom_vline(xintercept = 0.5) +
facet_grid(rows = vars(scen_name),
scales = "free_y",
switch = "y") +
labs(
x ="Beverage Category",
y = "thousand liters / yr",
fill = "container\ntype") +
theme(
text = element_text(size=14),
axis.text.x = element_text(angle = 45, hjust = 1),
panel.border = element_blank(),
strip.placement = "outside") +
scale_fill_brewer(palette = "Dark2")
FIGSI1
remove(FIGSI1)
#View(flow_bc_allscen) # Note the units = kilo liters / yr
flow_bc_allscen %>%
select(c("scen_name", "vol_kL", "cont_name", "bev_name")) %>%
pivot_wider(names_from = bev_name, values_from = vol_kL) %>%
arrange(cont_name) %>%
arrange(scen_name) %>%
replace(is.na(.), 0) %>%
write_csv("./data/data_tbls/TSI9_flow_kL_bc_allscen.csv")
remove(flow_bc_allscen)
imp_temp <- read_csv("./data/data_gen/imp_bsc_allscen.csv") %>%
rename(imp_type = impact_type)
## Rescale impact values
imp_scl <- imp_temp %>%
mutate(
value = case_when(
imp_type == "ghg" ~ value / 10^6,
imp_type == "h2o" ~ value / 10^6,
imp_type == "plastic" ~ value / 10^3
)) %>%
mutate(item = recode(item, bev = "beverage", cont = "container"))
#View(imp_scl)
remove(imp_temp)
temp_s0 <- imp_scl %>%
filter(scen == "scen0") %>%
filter(bev_type != "water_ucsb")
h1 <- temp_s0 %>%
filter(bev_type == "water_bottled")%>%
mutate(SSB_status = "SSB") %>%
mutate(value = 0)
imp_temp <- temp_s0 %>%
bind_rows(h1) %>%
group_by(bev_type, SSB_status, item, imp_type) %>%
summarize(value = sum(value)) %>%
ungroup()
## Make sure column names are same as the "names" file (up next)
imp_s0 <- imp_temp %>%
left_join(bevNames) %>%
left_join(impNames)
remove(h1)
remove(temp_s0)
remove(imp_temp)
FIG4 <- imp_s0 %>%
ggplot() + theme_bw() +
geom_col(aes(y = value, x = SSB_status, fill = item),
width = 0.8) +
facet_grid(vars(imp_regex_abs),
vars(bev_name),
switch = "y",
scales = "free",
#             labeller = label_parsed
labeller = labeller(
imp_regex_abs = label_parsed,
bev_name = label_wrap_gen(11)
)
) +
geom_hline(yintercept = 0) +
geom_vline(xintercept = 0.5) +
xlab("") +
ylab("") +
theme(
text = element_text(size = 16),
axis.text.x = element_text(angle = 45, hjust = 1),
legend.title=element_blank(),
legend.text=element_text(size=18),
panel.border = element_blank(),
strip.placement = "outside",
legend.position = c(0.93, 0.25),
legend.key.size = unit(0.92, 'cm'),
legend.box.background = element_rect(colour = "black")
#    strip.text = element_markdown()
) +
scale_fill_manual(values = col_vir1)
FIG4
View(imp_s0)
imp_s0 %>%
select(imp_name, SSB_status, item, bev_name, value) %>%
pivot_wider(names_from = bev_name, values_from = value) %>%
arrange(imp_type) %>%
write_csv("./data/data_tbls/TSI10_imp_ibs_scen0.csv")
imp_s0 %>%
select(imp_name, SSB_status, item, bev_name, value) %>%
pivot_wider(names_from = bev_name, values_from = value) %>%
arrange(imp_name) %>%
write_csv("./data/data_tbls/TSI10_imp_ibs_scen0.csv")
imp_s0 %>%
select(imp_name, SSB_status, item, bev_name, value) %>%
arrange(bev_name) %>%
pivot_wider(names_from = bev_name, values_from = value) %>%
arrange(imp_name) %>%
write_csv("./data/data_tbls/TSI10_imp_ibs_scen0.csv")
library(tidyverse)
s_all <- read_csv("./data/vol_dbsc_scen0_scen6.csv")
imp_cont <- read_csv("./data/cont_imp_l.csv")
#View(imp_cont)
imp_binb <- read_csv("./data/cont_imp_l_binb.csv")
#View(imp_binb)
imp_bev <- read_csv("./data/bev_imp_l.csv") %>%
mutate(plastic = 0) %>%
na.omit() #Water SSB are NA, so omit those
xbinb_temp <- s_all %>%
filter(cont_type != "bag_in_box") %>%
mutate(item = "cont") %>% #Getting impacts for the container
left_join(imp_cont) %>%
mutate(across(ghg:plastic, ~.x * liter_drink))
View(xbinb_temp)
binb_temp <- s_all %>%
filter(cont_type == "bag_in_box") %>%
mutate(item = "cont") %>% #Getting impacts for the container
left_join(imp_binb) %>%
mutate(across(ghg:plastic, ~.x * liter_drink))
View(binb_temp)
cont <- bind_rows(xbinb_temp,binb_temp)
bev <- s_all %>%
mutate(item = "bev") %>% #Getting impacts for the beverage
left_join(imp_bev) %>%
mutate(across(ghg:plastic, ~.x * liter_drink))
df_imp <- bind_rows(bev, cont) %>%
select(!c(liter_drink, liter_cont))
#View(df_imp)
any(is.na(df_imp))
imp_di <- df_imp %>%
group_by(scen, distrib, item) %>%
summarize(across(c(ghg:plastic), ~ sum(.x))) %>%
mutate(across(ghg:h2o, ~ .x/10^6)) %>%
mutate(plastic = plastic/1000) %>%
ungroup() %>%
write_csv("./tbls_s6/imp_di.csv")
imp_di <- df_imp %>%
group_by(scen, distrib, item) %>%
summarize(across(c(ghg:plastic), ~ sum(.x))) %>%
mutate(across(ghg:h2o, ~ .x/10^6)) %>%
mutate(plastic = plastic/1000) %>%
ungroup() %>%
write_csv("./tbls_s6/imp_di.csv")
imp_di <- df_imp %>%
group_by(scen, distrib, item) %>%
summarize(across(c(ghg:plastic), ~ sum(.x))) %>%
mutate(across(ghg:h2o, ~ .x/10^6)) %>%
mutate(plastic = plastic/1000) %>%
ungroup() %>%
write_csv("./data/tbls_s6/imp_di.csv")
imp_di <- df_imp %>%
group_by(scen, distrib, item) %>%
summarize(across(c(ghg:plastic), ~ sum(.x))) %>%
mutate(across(ghg:h2o, ~ .x/10^6)) %>%
mutate(plastic = plastic/1000) %>%
ungroup() %>%
write_csv("./data/data_tbls_s6/imp_di.csv")
imp_i <- df_imp %>%
group_by(scen, item) %>%
summarize(across(ghg:plastic, ~ sum(.x))) %>%
mutate(across(ghg:h2o, ~ .x/10^6)) %>%
mutate(plastic = plastic/1000) %>%
ungroup() %>%
write_csv("./data/data_tbls_s6/imp_i.csv")
imp_d <- df_imp %>%
group_by(scen, distrib) %>%
summarize(across(ghg:plastic, ~ sum(.x))) %>%
mutate(across(ghg:h2o, ~ .x/10^6)) %>%
mutate(plastic = plastic/1000) %>%
ungroup() %>%
write_csv("./data/data_tbls_s6/imp_d.csv")
imp <- df_imp %>%
group_by(scen) %>%
summarize(across(ghg:plastic, ~ sum(.x))) %>%
mutate(across(ghg:h2o, ~ .x/10^6)) %>%
mutate(plastic = plastic/1000) %>%
ungroup() %>%
write_csv("./data/data_tbls_s6/imp.csv")
imp_s <- df_imp %>%
group_by(scen, SSB_status) %>%
summarize(across(ghg:plastic, ~ sum(.x))) %>%
mutate(across(ghg:h2o, ~ .x/10^6)) %>%
mutate(plastic = plastic/1000) %>%
ungroup() %>%
write_csv("./data/data_tbls_s6/imp_s.csv")
imp_ds <- df_imp %>%
group_by(scen, distrib, SSB_status) %>%
summarize(across(ghg:plastic, ~ sum(.x))) %>%
mutate(across(ghg:h2o, ~ .x/10^6)) %>%
mutate(plastic = plastic/1000) %>%
ungroup() %>%
write_csv("./data/data_tbls_s6/imp_ds.csv")
