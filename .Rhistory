mutate(scen = recode(scen, scen0 = "Baseline")) %>%
arrange(cont_type) %>%
arrange(scen) %>%
replace(is.na(.), 0) %>%
write_csv("./data/data_tbls/flow_kL_bc_allscen.csv")
## Impact data
imp <- read_csv("./data/data_gen/imp_bsc_allscen.csv")
## Rescale impact values
imp_scl <- read_csv("./data/data_gen/imp_bsc_allscen.csv") %>%
mutate(
value = case_when(
impact_type == "ghg" ~ value / 10^6,
impact_type == "h2o" ~ value / 10^6,
impact_type == "plastic" ~ value / 10^3
)) %>%
left_join(bev_names) %>%
select(!bev_type) %>%
rename(bev_type = bev_name)
## Give impacts nicer names
## Seems like there should be a neater way to do this
## But not now
imp_scl$impact_name <- impnames[
match(imp_scl$impact_type, names(impnames)) ]
# imp_ibs_s0 ----------------------------------------------------------
#View(imp_scl)
temp_s0 <- imp_scl %>%
select(-impact_type) %>%
filter(scen == "scen0") %>%
filter(bev_type != "Water, Filtered tap")
## Make a "hack" to give SSB impacts = 0 for water bev types
## For aesthetic and plot readability reasons
h1 <- temp_s0 %>%
filter(bev_type == "Water, bottled")%>%
mutate(SSB_status = "SSB") %>%
mutate(value = 0)
imp_s0 <- temp_s0 %>%
bind_rows(h1) %>%
group_by(bev_type, SSB_status, item, impact_name) %>%
summarize(value = sum(value)) %>%
ungroup()
imp_s0 %>%
filter(bev_type != "Water, Filtered tap") %>%
mutate(item = recode(item, bev = "beverage", cont = "container")) %>%
ggplot() + theme_bw() +
geom_col(aes(y = value, x = SSB_status, fill = item),
width = 0.8) +
facet_grid(vars(impact_name),
vars(bev_type),
switch = "y",
scales = "free",
labeller = labeller(bev_type = label_wrap_gen(10))
# labeller = labeller(impact_names = label_wrap_gen(20))
) +
geom_hline(yintercept = 0) +
geom_vline(xintercept = 0.5) +
xlab("") +
ylab("") +
theme(
text = element_text(size = 14),
axis.text.x = element_text(angle = 45, hjust = 1),
panel.border = element_blank(),
legend.title=element_blank(),
strip.placement = "outside",
legend.position = c(0.93, 0.25),
legend.text=element_text(size=18),
legend.key.size = unit(1, 'cm'),
legend.box.background = element_rect(colour = "black")
) +
scale_fill_manual(values = col_vir1)
#  scale_fill_brewer(palette = "Dark2")
ggsave("./figs/imp_ibs_scen0.pdf", width=13, height=8, units="in")
#View(imp_s0)
imp_s0 %>%
pivot_wider(names_from = bev_type, values_from = value) %>%
relocate(impact_name) %>%
arrange(impact_name) %>%
write_csv("./data/data_tbls/imp_ibs_scen0.csv")
imp_i_allscen <- imp_scl %>%
select(-impact_type) %>%
group_by(scen, item, impact_name) %>%
summarize(value = sum(value)) %>%
ungroup() %>%
mutate(scen = recode(scen, scen0 = "Baseline")) %>%
mutate(item = recode(item, bev = "beverage", cont = "container"))
ggplot() + theme_bw() +
geom_col(data = imp_i_allscen,
aes(y = value, x = scen, fill = item),
width = 0.8) +
facet_grid(rows = vars(impact_name),
switch = "y",
scales = "free"
) +
geom_hline(yintercept = 0) +
geom_vline(xintercept = 0.5) +
xlab("") +
ylab("") +
theme(
text = element_text(size = 16),
axis.text.x = element_text(angle = 45, hjust = 1),
panel.border = element_blank(),
strip.placement = "outside",
legend.title=element_blank(),
legend.position = "top",
legend.text=element_text(size=18),
legend.key.size = unit(1, 'cm'),
) +
scale_fill_manual(values = col_vir1)
ggsave("./figs/imp_i_allscen.pdf", width=10, height=10, units="in")
imp_i_allscen %>%
pivot_wider(names_from = scen, values_from = value) %>%
relocate(impact_name) %>%
arrange(impact_name) %>%
write_csv("./data/data_tbls/imp_i_allscen_wide.csv")
imp_is_allscen <- imp_scl %>%
select(-impact_type) %>%
group_by(scen, item, SSB_status, impact_name) %>%
summarize(value = sum(value)) %>%
ungroup()
imp_is_allscen %>%
mutate(scen = recode(scen, scen0 = "Baseline")) %>%
mutate(item = recode(item, bev = "beverage", cont = "container")) %>%
ggplot() + theme_bw() +
geom_col(aes(y = value, x = SSB_status, fill = item),
width = 0.8) +
facet_grid(vars(impact_name),
vars(scen),
switch = "y",
scales = "free",
labeller = label_wrap_gen()
) +
geom_hline(yintercept = 0) +
geom_vline(xintercept = 0.5) +
xlab("") +
ylab("") +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
panel.border = element_blank(),
strip.placement = "outside",
text = element_text(size=14),
legend.title=element_blank()
) +
scale_fill_manual(values = col_vir1)
ggsave("./figs/imp_is_allscen.pdf", width=13, height=8, units="in")
summ_imp_wide <- imp_scl %>%
select(-impact_type) %>%
pivot_wider(names_from = impact_name, values_from = value) %>%
replace(is.na(.), 0)
#View(summ_imp_wide)
write_csv(summ_imp_wide, "./data/data_tbls/imp_bsc_allscen_wide.csv")
imp_i_allscen %>%
group_by(scen, impact_name) %>%
summarize(value = sum(value)) %>%
ungroup() %>%
pivot_wider(names_from = impact_name, values_from = value) %>%
write_csv("./data/data_tbls/imp_allscen.csv")
imp_s0 %>%
group_by(impact_name, item) %>%
summarize(value = sum(value)) %>%
pivot_wider(names_from = item, values_from = value) %>%
replace_na(list(bev = 0)) %>%
write_csv("./data/data_tbls/imp_scen0_summ.csv")
tbl_imp_scen0 <- imp_s0 %>%
group_by(impact_name, item) %>%
summarize(value = sum(value)) %>%
pivot_wider(names_from = item, values_from = value) %>%
replace_na(list(bev = 0)) %>%
write_csv("./data/data_tbls/result_overview.csv")
c1 <- read_csv("./data/cont_imp_l.csv") %>%
left_join(cont_names) %>%
select(!cont_type) %>%
rename(cont_type = cont_name)  %>%
pivot_longer(!cont_type, names_to = "imp_type", values_to = "val")
c1$imp_type <- impname_l[
match(c1$imp_type, names(impname_l)) ]
c1 %>%
ggplot() + theme_bw() +
geom_col(aes(y = val, x = cont_type), width = 0.8, fill = col_cont) +
facet_grid(rows = vars(imp_type),
switch = "y",
scales = "free") +
geom_hline(yintercept = 0) +
geom_vline(xintercept = 0.4) +
labs(
x ="Container Category",
y = "Impacts per liter of container (no beverage)") +
theme(
text = element_text(size=14),
axis.text.x = element_text(angle = 45, hjust = 1),
#    legend.text = element_text(size = 16),
#    axis.text.y = element_text(size = 16),
panel.border = element_blank(),
strip.placement = "outside")
c1 <- read_csv("./data/cont_imp_l.csv") %>%
left_join(cont_names) %>%
select(!cont_type) %>%
rename(cont_type = cont_name)  %>%
pivot_longer(!cont_type, names_to = "imp_type", values_to = "val")
c1 <- read_csv("./data/cont_imp_l.csv") %>%
left_join(cont_names) %>%
select(!cont_type) %>%
rename(cont_type = cont_name)  %>%
pivot_longer(!cont_type, names_to = "imp_type", values_to = "val")
last_error()
rlang::last_error()
c1 <- read_csv("./data/cont_imp_l.csv") %>%
left_join(cont_names)
View(c1)
c1 <- read_csv("./data/cont_imp_l.csv") %>%
left_join(cont_names) %>%
select(-cont_name_2)
View(c1)
c1 <- read_csv("./data/cont_imp_l.csv") %>%
left_join(cont_names) %>%
select(!cont_name_2) %>%
select(!cont_type) %>%
rename(cont_type = cont_name)  %>%
pivot_longer(!cont_type, names_to = "imp_type", values_to = "val")
c1$imp_type <- impname_l[
match(c1$imp_type, names(impname_l)) ]
c1 %>%
ggplot() + theme_bw() +
geom_col(aes(y = val, x = cont_type), width = 0.8, fill = col_cont) +
facet_grid(rows = vars(imp_type),
switch = "y",
scales = "free") +
geom_hline(yintercept = 0) +
geom_vline(xintercept = 0.4) +
labs(
x ="Container Category",
y = "Impacts per liter of container (no beverage)") +
theme(
text = element_text(size=14),
axis.text.x = element_text(angle = 45, hjust = 1),
#    legend.text = element_text(size = 16),
#    axis.text.y = element_text(size = 16),
panel.border = element_blank(),
strip.placement = "outside")
ggsave("./figs/FIG3_cont_imp_liter.pdf", width=4, height=8, units="in")
FIG3 <- c1 %>%
ggplot() + theme_bw() +
geom_col(aes(y = val, x = cont_type), width = 0.8, fill = col_cont) +
facet_grid(rows = vars(imp_type),
switch = "y",
scales = "free") +
geom_hline(yintercept = 0) +
geom_vline(xintercept = 0.4) +
labs(
x ="Container Category",
y = "Impacts per liter of container (no beverage)") +
theme(
text = element_text(size=14),
axis.text.x = element_text(angle = 45, hjust = 1),
#    legend.text = element_text(size = 16),
#    axis.text.y = element_text(size = 16),
panel.border = element_blank(),
strip.placement = "outside")
FIG3
ggsave("./figs/FIG3_cont_imp_liter.pdf", width=4, height=8, units="in")
FIG3 +
scale_fill_grey()
FIG3 +
scale_fill_grey()
c1 %>%
ggplot() + theme_bw() +
geom_col(aes(y = val, x = cont_type), width = 0.8, fill = grey60) +
facet_grid(rows = vars(imp_type),
switch = "y",
scales = "free") +
geom_hline(yintercept = 0) +
geom_vline(xintercept = 0.4) +
labs(
x ="Container Category",
y = "Impacts per liter of container (no beverage)") +
theme(
text = element_text(size=14),
axis.text.x = element_text(angle = 45, hjust = 1),
#    legend.text = element_text(size = 16),
#    axis.text.y = element_text(size = 16),
panel.border = element_blank(),
strip.placement = "outside")
c1 %>%
ggplot() + theme_bw() +
geom_col(aes(y = val, x = cont_type), width = 0.8) +
facet_grid(rows = vars(imp_type),
switch = "y",
scales = "free") +
geom_hline(yintercept = 0) +
geom_vline(xintercept = 0.4) +
labs(
x ="Container Category",
y = "Impacts per liter of container (no beverage)") +
theme(
text = element_text(size=14),
axis.text.x = element_text(angle = 45, hjust = 1),
#    legend.text = element_text(size = 16),
#    axis.text.y = element_text(size = 16),
panel.border = element_blank(),
strip.placement = "outside")
ggsave("./figs/FIG3bw_cont_imp_liter.pdf", width=4, height=8, units="in")
ggsave("./figs/figsBW/FIG3bw_cont_imp_liter.pdf", width=4, height=8, units="in")
b1 <- read_csv("./data/bev_imp_l.csv") %>%
left_join(bev_names) %>%
select(!bev_type) %>%
rename(bev_type = bev_name)   %>%
pivot_longer(!c("bev_type", "SSB_status"), names_to = "imp_type", values_to = "val")
b1$imp_type <- impname_l[
match(b1$imp_type, names(impname_l)) ]
b1 %>%
drop_na() %>%
filter(bev_type != "Water, tap") %>%
#  mutate(bev_type = recode(bev_type, "Water, UCSB" = "Water, tap")) %>%
ggplot() + theme_bw() +
geom_col(aes(y = val, x = bev_type), width = 0.8, fill = col_bev) +
facet_grid(rows = vars(imp_type),
cols = vars(SSB_status),
switch = "y",
scales = "free") +
geom_hline(yintercept = 0) +
geom_vline(xintercept = 0.41) +
labs(
x ="Beverage Category",
y = "Impacts per liter of beverage (no container)") +
theme(
text = element_text(size=14),
axis.text.x = element_text(angle = 45, hjust = 1),
strip.placement = "outside",
#    legend.text = element_text(size = 16),
#    axis.text.y = element_text(size = 16),
panel.border = element_blank() ) +
scale_y_continuous(labels=function(x) format(x, big.mark = ",", scientific=FALSE))
ggsave("./figs/FIG2_bev_imp_liter.pdf", width=8, height=8, units="in")
## Make BW version
b1 %>%
drop_na() %>%
filter(bev_type != "Water, tap") %>%
#  mutate(bev_type = recode(bev_type, "Water, UCSB" = "Water, tap")) %>%
ggplot() + theme_bw() +
geom_col(aes(y = val, x = bev_type), width = 0.8) +
facet_grid(rows = vars(imp_type),
cols = vars(SSB_status),
switch = "y",
scales = "free") +
geom_hline(yintercept = 0) +
geom_vline(xintercept = 0.41) +
labs(
x ="Beverage Category",
y = "Impacts per liter of beverage (no container)") +
theme(
text = element_text(size=14),
axis.text.x = element_text(angle = 45, hjust = 1),
strip.placement = "outside",
#    legend.text = element_text(size = 16),
#    axis.text.y = element_text(size = 16),
panel.border = element_blank() ) +
scale_y_continuous(labels=function(x) format(x, big.mark = ",", scientific=FALSE))
ggsave("./figs/figsBW/FIG2bw_bev_imp_liter.pdf", width=8, height=8, units="in")
imp_s0 %>%
filter(bev_type != "Water, Filtered tap") %>%
mutate(item = recode(item, bev = "beverage", cont = "container")) %>%
ggplot() + theme_bw() +
geom_col(aes(y = value, x = SSB_status, fill = item),
width = 0.8) +
facet_grid(vars(impact_name),
vars(bev_type),
switch = "y",
scales = "free",
labeller = labeller(bev_type = label_wrap_gen(10))
# labeller = labeller(impact_names = label_wrap_gen(20))
) +
geom_hline(yintercept = 0) +
geom_vline(xintercept = 0.5) +
xlab("") +
ylab("") +
theme(
text = element_text(size = 14),
axis.text.x = element_text(angle = 45, hjust = 1),
panel.border = element_blank(),
legend.title=element_blank(),
strip.placement = "outside",
legend.position = c(0.93, 0.25),
legend.text=element_text(size=18),
legend.key.size = unit(1, 'cm'),
legend.box.background = element_rect(colour = "black")
) +
scale_fill_manual(values = col_vir1)
#  scale_fill_brewer(palette = "Dark2")
ggsave("./figs/FIG4_imp_ibs_scen0.pdf", width=13, height=8, units="in")
FIG4 <- imp_s0 %>%
filter(bev_type != "Water, Filtered tap") %>%
mutate(item = recode(item, bev = "beverage", cont = "container")) %>%
ggplot() + theme_bw() +
geom_col(aes(y = value, x = SSB_status, fill = item),
width = 0.8) +
facet_grid(vars(impact_name),
vars(bev_type),
switch = "y",
scales = "free",
labeller = labeller(bev_type = label_wrap_gen(10))
# labeller = labeller(impact_names = label_wrap_gen(20))
) +
geom_hline(yintercept = 0) +
geom_vline(xintercept = 0.5) +
xlab("") +
ylab("") +
theme(
text = element_text(size = 14),
axis.text.x = element_text(angle = 45, hjust = 1),
panel.border = element_blank(),
legend.title=element_blank(),
strip.placement = "outside",
legend.position = c(0.93, 0.25),
legend.text=element_text(size=18),
legend.key.size = unit(1, 'cm'),
legend.box.background = element_rect(colour = "black")
) +
scale_fill_manual(values = col_vir1)
#  scale_fill_brewer(palette = "Dark2")
FIG4
ggsave("./figs/FIG4_imp_ibs_scen0.pdf", width=13, height=8, units="in")
## BW version
FIG4 +
scale_fill_grey()
## BW version
FIG4 +
scale_fill_grey(0.4,0.7)
## BW version
FIG4 +
scale_fill_grey(
start = 0.4,
end = 0.7)
## BW version
FIG4 +
scale_fill_grey(
start = 0.8,
end = 0.4)
## BW version
FIG4 +
scale_fill_grey(
start = 0.8,
end = 0.5)
## BW version
FIG4 +
scale_fill_grey(
start = 0.7,
end = 0.4)
ggsave("./figs/figsBW/FIG4bw_imp_ibs_scen0.pdf", width=13, height=8, units="in")
imp_i_allscen <- imp_scl %>%
select(-impact_type) %>%
group_by(scen, item, impact_name) %>%
summarize(value = sum(value)) %>%
ungroup() %>%
mutate(scen = recode(scen, scen0 = "Baseline")) %>%
mutate(item = recode(item, bev = "beverage", cont = "container"))
ggplot() + theme_bw() +
geom_col(data = imp_i_allscen,
aes(y = value, x = scen, fill = item),
width = 0.8) +
facet_grid(rows = vars(impact_name),
switch = "y",
scales = "free"
) +
geom_hline(yintercept = 0) +
geom_vline(xintercept = 0.5) +
xlab("") +
ylab("") +
theme(
text = element_text(size = 16),
axis.text.x = element_text(angle = 45, hjust = 1),
panel.border = element_blank(),
strip.placement = "outside",
legend.title=element_blank(),
legend.position = "top",
legend.text=element_text(size=18),
legend.key.size = unit(1, 'cm'),
) +
scale_fill_manual(values = col_vir1)
ggsave("./figs/FIG5_imp_i_allscen.pdf", width=10, height=10, units="in")
FIG5 <- ggplot() + theme_bw() +
geom_col(data = imp_i_allscen,
aes(y = value, x = scen, fill = item),
width = 0.8) +
facet_grid(rows = vars(impact_name),
switch = "y",
scales = "free"
) +
geom_hline(yintercept = 0) +
geom_vline(xintercept = 0.5) +
xlab("") +
ylab("") +
theme(
text = element_text(size = 16),
axis.text.x = element_text(angle = 45, hjust = 1),
panel.border = element_blank(),
strip.placement = "outside",
legend.title=element_blank(),
legend.position = "top",
legend.text=element_text(size=18),
legend.key.size = unit(1, 'cm'),
) +
scale_fill_manual(values = col_vir1)
FIG5
## BW version
FIG5 +
scale_fill_grey(
start = 0.7,
end = 0.4)
## BW version
FIG5 +
scale_fill_grey(
start = 0.7,
end = 0.35)
ggsave("./figs/figsBW/FIG5bw_imp_ibs_scen0.pdf", width=13, height=8, units="in")
